<html>
  <head>
    <title>CAA-Matlab description</title>
    <meta content="">
    <style></style>
  </head>
  <body>
  <h1>CAA-Matlab description</h1>
  <small>$Id$</small>
  <hr>
  <h2>Contents</h2>
  <ul>
  <li> <a href="#general">General concept</a> </li>
  <li> <a href="#req">Requirements</a> 
  <ul>
    <LI><a href="#req_da">Data</a></LI>
    <li><a href="#req_is">ISDAT</a></li>
    <li><a href="#req_ma">Matlab</a></LI>
  </ul>
  </li>
  <li> <a href="#conv">Conventions</a> 
  <ul>
    <li><a href="#conv_file">Files</a></li>
    <LI><a href="#conv_var">Variables</a></LI>
    <li><a href="#conv_t">Time</a></li>
  </ul>
  </li>
  <li> <a href="#do">Doing things</a> 
  <ul>
    <li> <a href="#do_es">Easy start</a> </li>
    <li> <a href="#do_re">Reading raw data</a> </li>
    <li> <a href="#do_bp">Basic plotting</a> </li>
    <li> <a href="#do_bc">Basic calibration</a> </li>
    <li> <a href="#do_sf">Spin fitting and despin</a> </li>
    <li> <a href="#do_ac">Advanced calibration</a> </li>
  </ul>
  </li>
  </ul>
  
  <h2><a name="general">General concept</a></h2>
  
  <h2><a name="req">Requirements</a></h2>
  <h3><a name="req_da">Data </a></h3>
  <p>You nees access to ISDAT server with EFW and CSDS (optional) modules. 
  Alternatively, or as a backup solution, you may read CSDS data directly from 
  CDF files.
  </p>
  
  <h3><a name="req_is">ISDAT-Matlab</a></h3>
  <p>You need an up-to-date ISDAT_Matlab interface from CVS. For instructions on 
  using CVS for getting ISDAT see 
  </p>
  <a href="http://www.space.irfu.se/isdat/using/HOWTO/using_CVS.html">ISDAT CVS HOWTO</a>.
  
  <h3><a name="req_ma">Matlab</a></h3>
  <p>You need Marlab R13 to read CDF files.
  </p>
  
  <h2><a name="conv">Conventions</a></h2>
  
  <h3><a name="conv_file">Files</a></h3>
  
  <p>All data is stored in Matlab's MAT files.</p>
  
<pre>
  >> ls *.mat

ans =

mA.mat          mEDSI.mat       mEdB.mat
mBPP.mat        mEPH.mat        mP.mat
mCIS.mat        mER.mat         mTMode.mat

</pre>

  <p>These files contain:</p>
  <ul>
    <li><tt>mA</tt> phase</li>
    <li><tt>mBPP</tt> B FGM PP (CSDS)</li>
    <li><tt>mCIS</tt> CIS PP (CSDS)</li>
    <li><tt>mEDSI</tt> EFW measured field and offsets in DSI, 
    prior to any assumtions about Ez</li>
    <li><tt>mEPH</tt> ephemeris</li>
    <li><tt>mER</tt> raw EFW data</li>
    <li><tt>mEdB</tt> EFW data with Ez computed from E.B=0</li>
    <li><tt>mP</tt> sc ponential</li>
    <li><tt>mTMode</tt> EFW telemetry mode</li>
  </ul>
  
  <h3><a name="conv_var">Variables</a></h3>
  
  <p>Almost all information about data quantity can be obtained from its name. 
  For example <tt>diE2p1234</tt> contains full resolution E from SC 2 in 
  DSI coordinate system. The signal is combined from probe pairs 12 and 34.
  <tt>diEs4p34</tt> contains spin resolution E from SC 4 and probe pair 34.</p>

  <p>Variables usually contain several columns, first of which is time and the rest is data. For example a variable woth size 12000x4 may contain time plus 3 components of a vector.</p>
  
  <h3><a name="conv_t">Time</a></h3>
  <p>We use time in ISDAT epoch, see <tt>help fromepoch, toepoch</tt>
  </p>
  
  <h2><a name="do">Doing things</a></h2>
  <h3><a name="do_es">Easy start</a></h3>
  
<p>
We want to look at data from all 4 Cluster sc for 2001-10-01 during period
13:10 - 15:50 UT.
</p>

<p>
First we create a directory to store data and set <tt>sp</tt> to it.
</p>
<pre>
>> mkdir /home/yuri/caa-data/20011001_1310
>> sp = '/home/yuri/caa-data/20011001_1310';
</pre>

<p>
Define start epoch and interval length
</p>
<pre>
>> st=toepoch([2001 10 01 13 10 00])

st =

   1.0019e+09
   
>> dt=160*60;
</pre>
<p>
Next we get all possible data (EFW + FGM,CIS,EDI PP) on disk and despin it.
</p>

<pre>
>> getRData(sp,st,dt)

...

EFW...sc4...Ep12 10Hz filter
EFW...sc4...Ep34 10Hz filter
 wE4p12  wE4p34  -> ./mER.mat
EFW...sc4...probe1->P10Hz4p1
EFW...sc4...probe2->P10Hz4p2
EFW...sc4...probe3->P10Hz4p3
EFW...sc4...probe4->P10Hz4p4
 P10Hz4p1 P10Hz4p2 P10Hz4p3 P10Hz4p4 P10Hz4  P4 NVps4 -> ./mP.mat
 A4  -> ./mA.mat
 SAX4 -> ./mEPH.mat
 BPP4 diBPP4 -> ./mBPP.mat
/data/cluster/CSDS/PP/EDI/C4/C4_PP_EDI_20011001*
cdf file: /data/cluster/CSDS/PP/EDI/C4/C4_PP_EDI_20011001_V01.CDF
/data/cluster/CSDS/PP/CIS/C4/C4_PP_CIS_20011001*
cdf file: /data/cluster/CSDS/PP/CIS/C4/C4_PP_CIS_20011001_V03.CDF
 VCp4 diVCp4 VCh4 diVCh4 -> ./mCIS.mat
 VCEp4 diVCEp4 VCEh4 diVCEh4 -> ./mCIS.mat

 ...

Spin fit wE4p12 -> diEs4p12
2399 spins processed, 0 gaps found
Spin fit wE4p34 -> diEs4p34
2399 spins processed, 0 gaps found
delta offsets are: 0.74 [x] 0.03 [y]
correcting p12
 diEs4p12  diEs4p34  D4p12p34  -> ./mEDSI.mat
Da4dp12 : 0.52
Da4dp34 : 0.12
correcting p12
rotation period=4.0116 s
 Da4p12  Da4p34  diE4p1234  -> ./mEDSI.mat
</pre>

<p>
Calibrate sunward offset and amplitude factors. 
It is better to start from the spacecraft for which you have CIS and EDI data.
The osstest are usually similar for all SC (not always).
First correct the sunward field Ex, and then the amplitude. It is better to use
calm regions or places where the DC electric field changes sign. 
Note, it may be difficult to get a value of sunward offset which will fit all
the time interval if the spacecraft potential changes.
</p>

<pre>
>> corrSOffsetM(ClusterProc(sp),1)
Give Ex and Ey offset [mV/m] and amplitude factor (s-save,q-quit,r-read,h-show/hide high res)[0.00 0.00 1.00 ]>1 0 1
Give Ex and Ey offset [mV/m] and amplitude factor (s-save,q-quit,r-read,h-show/hide high res)[1.30 0.00 1.00 ]>1.3 0 1
Give Ex and Ey offset [mV/m] and amplitude factor (s-save,q-quit,r-read,h-show/hide high res)[1.30 0.00 1.00 ]>1.3 0 1.2
Give Ex and Ey offset [mV/m] and amplitude factor (s-save,q-quit,r-read,h-show/hide high res)[1.30 0.00 1.20 ]>s
Ddsi1, Damp1 -> ./mEDSI.mat
Give Ex and Ey offset [mV/m] and amplitude factor (s-save,q-quit,r-read,h-show/hide high res)[1.30 0.00 1.20 ]>q
</pre>

<p>Plot summary information. This step will compute Ez from E.B=0 for times when 
magnetic field is more the 15 degrees from the spin plane, and then compute ExB.</p>

<pre>
>> doSPlot(sp)
</pre>

<p>Now you should get four plots with data for all Cluster SC, and all the processed 
data is saved in a directory <tt>/home/yuri/caa-data/20011001_1310</tt>.
</p>

<pre>
</pre>  
  <h3><a name="do_re">Reading raw data</a></h3>
  <p>see <tt>help ClusterDB/getData</tt></p>
  
  <h3><a name="do_bp">Basic plotting</a></h3>
  <ul>
  <LI><tt>av_tplot</tt> for general plotting</LI>
  <li><tt>summaryRPlot</tt> simple summary of EFW</li>
  <li><tt>ClusterProc/summaryPlot</tt> more advanced summary plot including ExB</li>
  </ul>
  
  <h3><a name="do_bc">Basic calibration</a></h3>
  <p>Basic calibrations such as ADC offset and p12-p34 differences are done 
  automatically by <tt>ClusterProc/getData</tt></p>
  
  <h3><a name="do_sf">Spin fitting and despin</a></h3>
  <p>see <tt>help ClusterProc/getData</tt></p>
  
  <h3><a name="do_ac">Advanced calibration</a></h3>
  <p>see <tt>help ClusterProc/corrSOffsetM</tt></p>
  </body>
</html>
