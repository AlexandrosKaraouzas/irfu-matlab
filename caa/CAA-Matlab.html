<html>
  <head>
    <title>CAA-Matlab description</title>
    <meta content=""><style></style>
  </head>
  <body>
  <h1>CAA-Matlab description</h1>
  <small>$Id$</small>
  <hr>
  <h2>Contents</h2>
  <ul>
  <li> <a href="#general">General concept</a> </li>
  <li> <a href="#req">Requirements</a> 
  <ul>
    <LI><a href="#req_da">Data</a></LI>
    <li><a href="#req_is">ISDAT</a></li>
    <li><a href="#req_ma">Matlab</a></LI>
  </ul>
  </li>
  <li> <a href="#conv">Conventions</a> 
  <ul>
    <li><a href="#conv_file">Files</a></li>
    <LI><a href="#conv_var">Variables</a></LI>
    <li><a href="#conv_t">Time</a></li>
  </ul>
  </li>
  <li> <a href="#do">Doing things</a> 
  <ul>
    <li> <a href="#do_es">Easy start</a> </li>
    <li> <a href="#do_re">Reading raw data</a> </li>
    <li> <a href="#do_bp">Basic plotting</a> </li>
    <li> <a href="#do_bc">Basic calibration</a> </li>
    <li> <a href="#do_sf">Spin fitting and despin</a> </li>
    <li> <a href="#do_ac">Advanced calibration</a> </li>
  </ul>
  </li>
  </ul>
  
  <h2><a name="general">General concept</a></h2>
  
  <h2><a name="req">Requirements</a></h2>
  <h3><a name="req_da">Data </a></h3>
  <p>You nees access to ISDAT server with EFW and CSDS (optional) modules. 
  Alternatively, or as a backup solution, you may read CSDS data directly from 
  CDF files.
  </p>
  
  <h3><a name="req_is">ISDAT-Matlab</a></h3>
  <p>You need an up-to-date ISDAT_Matlab interface from CVS. For instructions on 
  using CVS for getting ISDAT see 
  </p>
  <a href="http://www.space.irfu.se/isdat/using/HOWTO/using_CVS.html">ISDAT CVS HOWTO</a>.
  
  <h3><a name="req_ma">Matlab</a></h3>
  <p>You need Marlab R13 to read CDF files.
  </p>
  
  <h2><a name="conv">Conventions</a></h2>
  
  <h3><a name="conv_file">Files</a></h3>
  
  <p>All data is stored in Matlab's MAT files.</p>
  
<pre>
  >> ls *.mat

ans =

mA.mat          mEDSI.mat       mEdB.mat
mBPP.mat        mEPH.mat        mP.mat
mCIS.mat        mER.mat         mTMode.mat

</pre>

  <p>These files contain:</p>
  <ul>
    <li><tt>mA</tt> phase</li>
    <li><tt>mBPP</tt> B FGM PP (CSDS)</li>
    <li><tt>mCIS</tt> CIS PP (CSDS)</li>
    <li><tt>mEDSI</tt> EFW measured field and offsets in DSI, 
    prior to any assumtions about Ez</li>
    <li><tt>mEPH</tt> ephemeris</li>
    <li><tt>mER</tt> raw EFW data</li>
    <li><tt>mEdB</tt> EFW data with Ez computed from E.B=0</li>
    <li><tt>mP</tt> sc ponential</li>
    <li><tt>mTMode</tt> EFW telemetry mode</li>
  </ul>
  
  <h3><a name="conv_var">Variables</a></h3>
  
  <p>Almost all information about data quantity can be obtained from its name. 
  For example <tt>diE2p1234</tt> contains full resolution E from SC 2 in 
  DSI coordinate system. The signal is combined from probe pairs 12 and 34.
  <tt>diEs4p34</tt> contains spin resolution E from SC 4 and probe pair 34.</p>

  <p>Variables usually contain several columns, first of which is time and the rest is data. For example a variable woth size 12000x4 may contain time plus 3 components of a vector.</p>
  
  <h3><a name="conv_t">Time</a></h3>
  <p>We use time in ISDAT epoch, see <tt>help fromepoch, toepoch</tt>
  </p>
  
  <h2><a name="do">Doing things</a></h2>
  <h3><a name="do_es">Easy start</a></h3>
  
<p>
We want to look at data from all 4 Cluster sc for 2001-10-01 during period
13:10 - 15:50 UT.
</p>

<p>
First we create a directory to store data and set <tt>sp</tt> to it.
</p>
<pre>
>> mkdir /home/yuri/caa-data/20011001_1310
>> sp = '/home/yuri/caa-data/20011001_1310';
</pre>

<p>
Define start epoch and interval length
</p>
<pre>
>> st=toepoch([2001 10 01 13 10 00])

st =

   1.0019e+09
   
>> dt=160*60;
</pre>
<p>
      Next we get all possible data (EFW + FGM,CIS,EDI PP, ephemeris) on disk and despin it.
    </p>

<pre>
>> getRData(st,dt,'sp',sp)
[2004-09-08 16:39:51][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:39:56][getData : dsrc] EFW...sc1...Ep12 10Hz filter
[2004-09-08 16:39:57][getData : dsrc] EFW...sc1...Ep34 10Hz filter
[2004-09-08 16:39:58][getData : save]  wE1p12  wE1p34  -> ./mER.mat
[2004-09-08 16:39:59][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:39:59][getData : dsrc] EFW...sc1...probe1->P10Hz1p1
[2004-09-08 16:39:59][getData : dsrc] EFW...sc1...probe2->P10Hz1p2
[2004-09-08 16:40:00][getData : dsrc] EFW...sc1...probe3->P10Hz1p3
[2004-09-08 16:40:00][getData : dsrc] EFW...sc1...probe4->P10Hz1p4
[2004-09-08 16:40:01][getData : save]  P10Hz1p1 P10Hz1p2 P10Hz1p3 P10Hz1p4 P10Hz1  P1 NVps1 -> ./mP.mat
[2004-09-08 16:40:02][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:03][getData : save]  A1  -> ./mA.mat
[2004-09-08 16:40:03][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:03][getData : save]  SAX1 -> ./mEPH.mat
[2004-09-08 16:40:03][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:03][getData : save]  R1  -> ./mR.mat
[2004-09-08 16:40:03][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:04][getData : save]  V1  -> ./mR.mat
[2004-09-08 16:40:04][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:08][getData : save]  WHIP1  -> ./mFDM.mat
[2004-09-08 16:40:08][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:08][getData : save]  BPP1 diBPP1 -> ./mBPP.mat
[2004-09-08 16:40:08][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
Warning: Mat_DbGetDataLite: Data request could not be fulfilled.
Warning: Reason given by server: no data
Warning: Mat_DbGetDataLite: Data request could not be fulfilled.
Warning: Reason given by server: no data
[2004-09-08 16:40:10][readCSDS : dsrc] Using FILE
/data/cluster/CSDS/PP/EDI/C1/C1_PP_EDI_20011001*
C1_PP_EDI_20011001_V01.CDF
C1_PP_EDI_20011001_V02.CDF
cdf file: /data/cluster/CSDS/PP/EDI/C1/C1_PP_EDI_20011001_V02.CDF
[2004-09-08 16:40:12][getData : dsrc] No data
[2004-09-08 16:40:12][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:12][getData : save]  NCp1 NCh1 -> ./mCIS.mat
[2004-09-08 16:40:12][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:12][getData : save]  VCp1 diVCp1 VCh1 diVCh1 -> ./mCIS.mat
[2004-09-08 16:40:12][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:13][getData : save]  VCEp1 diVCEp1 VCEh1 diVCEh1 -> ./mCIS.mat

...

[2004-09-08 16:45:45][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:45:45][getData : proc] Spin fit wE4p12 -> diEs4p12
[2004-09-08 16:45:45][getData : proc] not using times with Whisper pulses
[2004-09-08 16:46:23][EfwDoSpinFit : proc] 2399 spins processed, 184 gaps found
[2004-09-08 16:46:23][getData : proc] Spin fit wE4p34 -> diEs4p34
[2004-09-08 16:46:23][getData : proc] not using times with Whisper pulses
[2004-09-08 16:47:00][EfwDoSpinFit : proc] 2399 spins processed, 184 gaps found
[2004-09-08 16:47:00][getData : calb] delta offsets are: 0.75 [x] 0.03 [y]
[2004-09-08 16:47:00][getData : calb] correcting p12
[2004-09-08 16:47:00][getData : save]  diEs4p12  diEs4p34  D4p12p34  -> ./mEDSI.mat
[2004-09-08 16:47:00][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:47:00][corrADCOffset : proc] ADC offset: not using times with Whisper pulses
[2004-09-08 16:47:01][getData : calb] Da4dp12 : 0.52
[2004-09-08 16:47:01][corrADCOffset : proc] ADC offset: not using times with Whisper pulses
[2004-09-08 16:47:02][getData : calb] Da4dp34 : 0.12
[2004-09-08 16:47:02][getData : calb] correcting p12
[2004-09-08 16:47:02][c_despin : proc] rotation period=4.0116 s
[2004-09-08 16:47:03][getData : save]  Da4p12  Da4p34 diE4p1234 -> ./mEDSI.mat
</pre>

<p>If you think it is too much debugging information on the screen,please look at <tt>help c_log</tt>. 
For example you can limit the output only to database, calibration and processing messages. To do so run</p>

<pre>
>> c_log('log_lev',2+16+32)
</pre>

<p>
Now calibrate sunward/duskward offset and amplitude correction factors. 
It is better to start from the spacecraft for which you have CIS and EDI data.
The osstest are usually similar for all SC (not always).
First correct the sunward field Ex, and then the amplitude. It is better to use
calm regions or places where the DC electric field changes sign. 
Note, it may be difficult to get a value of sunward offset which will fit all
the time interval if the spacecraft potential changes.
</p>

<pre>
>> corrSOffsetM(ClusterProc(sp),1)
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[0.00 0.00 1.00 ]>h
Usage:
  give 3 numders for offsets in Ex, Ey and amplitude
  correction or one of the following commands:
  s - save calibration parameters
  r - read from disk
  f - show/hide full resolution data
  q - quit
  h - help (this message)
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[0.00 0.00 1.00 ]>1 0 1
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[1.00 0.00 1.00 ]>1.1 0 1
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[1.10 0.00 1.00 ]>s
Ddsi1, Damp1 -> ./mEDSI.mat
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[1.10 0.00 1.00 ]>q
</pre>

<p>Plot summary information. This step will compute Ez from E.B=0 for times when 
magnetic field is more the 15 degrees from the spin plane, and then compute ExB. We do it only for SC 1.</p>

<pre>
>> doSPlot(sp,1)
[2004-09-08 16:55:22][proc] using p34
[2004-09-08 16:55:22][proc] using angle limit of 15 degrees
[2004-09-08 16:55:22][proc] setting points < ang_limit to NaN
[2004-09-08 16:55:26][proc] using angle limit of 15 degrees
[2004-09-08 16:55:27][proc] setting points < ang_limit to NaN
</pre>

<p>Now you should get four plots with data for all Cluster SC, and all the processed 
data is saved in a directory <tt>/home/yuri/caa-data/20011001_1310</tt>.
</p>

<pre>
</pre>  
  <h3><a name="do_re">Reading raw data</a></h3>
  <p>see <tt>help ClusterDB/getData</tt></p>
  
  <h3><a name="do_bp">Basic plotting</a></h3>
  <ul>
  <LI><tt>av_tplot</tt> for general plotting</LI>
  <li><tt>summaryRPlot</tt> simple summary of EFW</li>
  <li><tt>ClusterProc/summaryPlot</tt> more advanced summary plot including ExB</li>
  </ul>
  
  <h3><a name="do_bc">Basic calibration</a></h3>
  <p>Basic calibrations such as ADC offset and p12-p34 differences are done 
  automatically by <tt>ClusterProc/getData</tt></p>
  
  <h3><a name="do_sf">Spin fitting and despin</a></h3>
  <p>see <tt>help ClusterProc/getData</tt></p>
  
  <h3><a name="do_ac">Advanced calibration</a></h3>
  <p>see <tt>help ClusterProc/corrSOffsetM</tt></p>
  </body>
</html>
