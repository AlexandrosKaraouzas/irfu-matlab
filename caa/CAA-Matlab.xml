<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.1.2//EN"
               "http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd" [
<!ENTITY matl "MATLAB">
<!ENTITY is "ISDAT">
]>
<book>
<bookinfo>
	<title>CAA &matl; Documentation</title>
	<releaseinfo role="CVS">$Id$</releaseinfo>
	<author>
		<firstname>Yuri</firstname><surname>Khotyaintsev</surname>
		<affiliation><orgname>IRF, Uppsala</orgname><address><email>yuri@irfu.se</email></address></affiliation>
	</author>
	<copyright><year>2004</year><holder>Yuri Khotyaintsev</holder></copyright>
</bookinfo>
<preface><title>Preface</title>
<para>This document is intended... The latest version of this document
is located on the 
<ulink url="http://www.cluster.irfu.se/intra/CAA-Matlab.html">
<citetitle>EFW-&matl; homepage</citetitle>
</ulink>.
</para>
</preface>

<chapter id="fast-howto">
<title>Fast HOWTO</title>

<para>
Our goal of this HOWTO is to have a look at data from all 4 Cluster sc 
for 2001-10-01 during period 13:10 - 15:50 UT. Before starting please check that
you have everything listed in the <link linkend="requirements">Requirements</link>
section.
</para>

<para>
First we define a directory where we want to store the data and set 
variable <varname>sp</varname> to it.
<screen>
&gt;&gt; sp = '/home/yuri/caa-data/20011001_1310';
</screen>
</para>

<para>
Define start epoch and interval length
<screen>
&gt;&gt; st=toepoch([2001 10 01 13 10 00])

st =

   1.0019e+09
   
&gt;&gt; dt=160*60;
</screen>
</para>

<para>
Next, we get all possible data (EFW + FGM,CIS,EDI PP, ephemeris) on disk 
and perform spin fits and despining.
<screen>
>> getRData(st,dt,'sp',sp)
[2004-09-08 16:39:51][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:39:56][getData : dsrc] EFW...sc1...Ep12 10Hz filter
[2004-09-08 16:39:57][getData : dsrc] EFW...sc1...Ep34 10Hz filter
[2004-09-08 16:39:58][getData : save]  wE1p12  wE1p34  -> ./mER.mat
[2004-09-08 16:39:59][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:39:59][getData : dsrc] EFW...sc1...probe1->P10Hz1p1
[2004-09-08 16:39:59][getData : dsrc] EFW...sc1...probe2->P10Hz1p2
[2004-09-08 16:40:00][getData : dsrc] EFW...sc1...probe3->P10Hz1p3
[2004-09-08 16:40:00][getData : dsrc] EFW...sc1...probe4->P10Hz1p4
[2004-09-08 16:40:01][getData : save]  P10Hz1p1 P10Hz1p2 P10Hz1p3 P10Hz1p4 P10Hz1  P1 NVps1 -> ./mP.mat
[2004-09-08 16:40:02][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:03][getData : save]  A1  -> ./mA.mat
[2004-09-08 16:40:03][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:03][getData : save]  SAX1 -> ./mEPH.mat
[2004-09-08 16:40:03][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:03][getData : save]  R1  -> ./mR.mat
[2004-09-08 16:40:03][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:04][getData : save]  V1  -> ./mR.mat
[2004-09-08 16:40:04][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:08][getData : save]  WHIP1  -> ./mFDM.mat
[2004-09-08 16:40:08][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:08][getData : save]  BPP1 diBPP1 -> ./mBPP.mat
[2004-09-08 16:40:08][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
Warning: Mat_DbGetDataLite: Data request could not be fulfilled.
Warning: Reason given by server: no data
Warning: Mat_DbGetDataLite: Data request could not be fulfilled.
Warning: Reason given by server: no data
[2004-09-08 16:40:10][readCSDS : dsrc] Using FILE
/data/cluster/CSDS/PP/EDI/C1/C1_PP_EDI_20011001*
C1_PP_EDI_20011001_V01.CDF
C1_PP_EDI_20011001_V02.CDF
cdf file: /data/cluster/CSDS/PP/EDI/C1/C1_PP_EDI_20011001_V02.CDF
[2004-09-08 16:40:12][getData : dsrc] No data
[2004-09-08 16:40:12][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:12][getData : save]  NCp1 NCh1 -> ./mCIS.mat
[2004-09-08 16:40:12][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:12][getData : save]  VCp1 diVCp1 VCh1 diVCh1 -> ./mCIS.mat
[2004-09-08 16:40:12][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:40:13][getData : save]  VCEp1 diVCEp1 VCEh1 diVCEh1 -> ./mCIS.mat

...

[2004-09-08 16:45:45][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:45:45][getData : proc] Spin fit wE4p12 -> diEs4p12
[2004-09-08 16:45:45][getData : proc] not using times with Whisper pulses
[2004-09-08 16:46:23][EfwDoSpinFit : proc] 2399 spins processed, 184 gaps found
[2004-09-08 16:46:23][getData : proc] Spin fit wE4p34 -> diEs4p34
[2004-09-08 16:46:23][getData : proc] not using times with Whisper pulses
[2004-09-08 16:47:00][EfwDoSpinFit : proc] 2399 spins processed, 184 gaps found
[2004-09-08 16:47:00][getData : calb] delta offsets are: 0.75 [x] 0.03 [y]
[2004-09-08 16:47:00][getData : calb] correcting p12
[2004-09-08 16:47:00][getData : save]  diEs4p12  diEs4p34  D4p12p34  -> ./mEDSI.mat
[2004-09-08 16:47:00][getData : save] Storage directory is /home/yuri/caa-data/20011001_1310
[2004-09-08 16:47:00][corrADCOffset : proc] ADC offset: not using times with Whisper pulses
[2004-09-08 16:47:01][getData : calb] Da4dp12 : 0.52
[2004-09-08 16:47:01][corrADCOffset : proc] ADC offset: not using times with Whisper pulses
[2004-09-08 16:47:02][getData : calb] Da4dp34 : 0.12
[2004-09-08 16:47:02][getData : calb] correcting p12
[2004-09-08 16:47:02][c_despin : proc] rotation period=4.0116 s
[2004-09-08 16:47:03][getData : save]  Da4p12  Da4p34 diE4p1234 -> ./mEDSI.mat
</screen>
</para>

<para>
If you think it is too much debugging information on the screen,please look at 
help <function>c_log</function>. 
For example you can limit the output only to database, calibration and 
processing messages. To do so run
<screen>
>> c_log('log_lev',2+16+32)
</screen>
</para>

<para>
Now calibrate sunward/duskward offset and amplitude correction factors. 
It is better to start from the spacecraft for which you have CIS and EDI data.
The osstest are usually similar for all SC (not always).
First correct the sunward field E<subscript>x</subscript>, and then the amplitude. 
It is better to use
calm regions or places where the DC electric field changes sign. 
Note, it may be difficult to get a value of sunward offset which will fit all
the time interval if the spacecraft potential changes.
<screen>
>> corrSOffsetM(ClusterProc(sp),1)
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[0.00 0.00 1.00 ]>h
Usage:
  give 3 numders for offsets in Ex, Ey and amplitude
  correction or one of the following commands:
  s - save calibration parameters
  r - read from disk
  f - show/hide full resolution data
  q - quit
  h - help (this message)
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[0.00 0.00 1.00 ]>1 0 1
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[1.00 0.00 1.00 ]>1.1 0 1
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[1.10 0.00 1.00 ]>s
Ddsi1, Damp1 -> ./mEDSI.mat
Delta Ex,Ey [mV/m], amplitude factor (s,r,f,q,h-help)[1.10 0.00 1.00 ]>q
</screen>
</para>

<para>
Plot summary information. This step will compute E<subscript>z</subscript> from 
E.B=0 for times when 
magnetic field is more the 15 degrees from the spin plane, 
and then compute ExB. We do it only for SC 1.
<screen>
>> doSPlot(sp,1)
[2004-09-08 16:55:22][proc] using p34
[2004-09-08 16:55:22][proc] using angle limit of 15 degrees
[2004-09-08 16:55:22][proc] setting points &lt; ang_limit to NaN
[2004-09-08 16:55:26][proc] using angle limit of 15 degrees
[2004-09-08 16:55:27][proc] setting points &lt; ang_limit to NaN
</screen>
</para>

<para>
Now you should get four plots with data for all Cluster SC, and all the processed 
data is saved in a directory <filename>/home/yuri/caa-data/20011001_1310</filename>.
</para>

</chapter>

<chapter id="requirements">
<title>Requirements</title>
<para>
This chapter describes general requirements for running EFW-CAA software
</para>

<section id="req-data">
<title>Data</title>
<para>
You nees access to &is; server with EFW and CSDS (optional) modules. 
Alternatively, or as a backup solution, you may read CSDS data directly from 
CDF files.
</para>
</section>

<section id="req-matl">
<title>&matl;</title>
<para>
You will need &matl; 7.0 (R14) for the softare described here to work
</para>
</section>

<section id="req-ismatl">
<title>&is;-&matl; interface</title>
<para>
You need an up-to-date &is;-&matl; interface from CVS. For instructions on 
using CVS for getting ISDAT see 
<ulink url="http://www.space.irfu.se/isdat/using/HOWTO/using_CVS.html">
<citetitle>ISDAT CVS HOWTO</citetitle>
</ulink>
</para>
</section>
</chapter>

<chapter id="conventions">
<title>Conventions</title>
<para>
This section describe general conventions and standarts for variables
and file names.
</para>

<section id="conv-vars">
<title>Variables</title>
<para>Here we describe variables.</para>

<para>
Almost all information about data quantity can be obtained from its name. 
For example <varname>diE2p1234</varname> contains full resolution E from SC 2 in 
<link linkend="conv-cs">DSI</link> coordinate system. 
The signal is combined from probe pairs 12 and 34.
<varname>diEs4p34</varname> contains spin resolution E from SC 4 and probe pair 34.
</para>

<para>Variables usually contain several columns, first of which is time and the 
rest is data. For example a variable which size is 12000x4 may contain time plus 
3 components of a vector.
</para>
</section>

<section id="conv-files">
<title>Files</title>
<para>Here we describe files.</para>

<para>All data is stored in &matl;'s MAT files:
<screen>
>> ls *.mat

ans =

mA.mat          mEDSI.mat       mEdB.mat
mBPP.mat        mEPH.mat        mP.mat
mCIS.mat        mER.mat         mTMode.mat

</screen>
</para>

<para>These files contain:</para>
<itemizedlist spacing="compact" mark='opencircle'>
<listitem>
<para>
<filename>mA</filename> phase;
</para>
</listitem>
<listitem>
<para>
<filename>mBPP</filename> B FGM PP (CSDS);
</para>
</listitem>
<listitem>
<para>
<filename>mB</filename> B FGM;
</para>
</listitem>
<listitem>
<para>
<filename>mCIS</filename> CIS PP (CSDS);
</para>
</listitem>
<listitem>
<para>
<filename>mEDSI</filename> EFW measured field and offsets in DSI, 
prior to any assumtions about Ez
</para>
</listitem>
<listitem>
<para>
<filename>mEPH</filename> ephemeris
</para>
</listitem>
<listitem>
<para>
<filename>mER</filename> raw EFW data
</para>
</listitem>
<listitem>
<para>
<filename>mEdB</filename> EFW data with Ez computed from E.B=0
</para>
</listitem>
<listitem>
<para>
<filename>mP</filename> sc ponential
</para>
</listitem>
<listitem>
<para>
<filename>mTMode</filename> EFW telemetry mode
</para>
</listitem>
</itemizedlist>
</section>

<section><title>Time</title>
<para>Here we describe time.</para>

<para>
We use time in &is; epoch, see &matl; help for <function>fromepoch</function>, 
<function>toepoch</function>.
</para>
</section>

<section id="conv-cs">
<title>Coordinate systems</title>
<para>Here we describe coordinate systems.</para>
</section>

<section id="conv-rf">
<title>Reference frames</title>
<para>Here we describe reference frames</para>
</section>
</chapter>

<chapter id="howto">
<title>How to do things</title>
<para>
This section describe common operations one needs to perform on data.
</para>

<section id="reading-raw">
<title>Loading raw data from &is; or CSDS CDF files</title>
<para>
See help for <function>ClusterDB/getData</function>
</para>
</section>
  
<section id="loading">
<title>Loading data saved on disk</title>
<para>
See help for <function>c_load</function>
</para>
</section>

<section id="plotting">
<title>Basic plotting</title>
<itemizedlist spacing="compact" mark='opencircle'>
<listitem>
<para>
<function>av_tplot</function> for general plotting;
</para>
</listitem>
<listitem>
<para>
<function>c_pl_tx</function> for general plotting of four SC data.;
</para>
</listitem>
<listitem>
<para>
<function>summaryRPlot</function> simple summary of EFW;
</para>
</listitem>
<listitem>
<para>
<function>ClusterProc/summaryPlot</function> more advanced summary plot 
including ExB.
</para>
</listitem>
</itemizedlist>
</section>
  
<section id="bas-calibration">
<title>Basic calibration</title>
<para>
Basic calibrations such as ADC offset and p12-p34 differences are done 
automatically by <function>ClusterProc/getData</function>.
</para>
</section>

<section id="sfit">
<title>Spin fitting and despin</title>
<para>
See help for <function>ClusterProc/getData</function>
</para>
</section>

<section id="adv-calibration">
<title>Advanced calibration</title>
<para>
See help for <function>ClusterProc/corrSOffsetM</function>
</para>
</section>

<section id="processing">
<title>Processing steps</title>
<para>
This section describes internals of the processing algoritms used.
</para>
</section>

</chapter>
</book>
